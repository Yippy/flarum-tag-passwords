(()=>{var t={n:s=>{var o=s&&s.__esModule?()=>s.default:()=>s;return t.d(o,{a:o}),o},d:(s,o)=>{for(var e in o)t.o(o,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:o[e]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s);const o=flarum.core.compat["forum/app"];var e=t.n(o);const a=flarum.core.compat["tags/models/Tag"];var r=t.n(a);const i=flarum.core.compat["common/Model"];var n=t.n(i);const c=flarum.core.compat["common/models/Discussion"];var l=t.n(c);const u=flarum.core.compat["common/extend"],d=flarum.core.compat["tags/components/TagLinkButton"];var p=t.n(d);const f=flarum.core.compat["common/helpers/icon"];var g=t.n(f);const h=flarum.core.compat["tags/components/TagsPage"];var v=t.n(h);const P=flarum.core.compat["tags/common/helpers/tagIcon"];var y=t.n(P);const T=flarum.core.compat["tags/common/utils/sortTags"];var b=t.n(T);const w=flarum.core.compat["common/utils/classList"];var _=t.n(w);const N=flarum.core.compat["common/helpers/textContrastClass"];var D=t.n(N);const k=flarum.core.compat["common/components/Link"];var L=t.n(k);const x=flarum.core.compat["common/helpers/humanTime"];var I=t.n(x);const U=flarum.core.compat["common/components/LoadingIndicator"];var F=t.n(U);const S=flarum.core.compat["common/utils/ItemList"];var O=t.n(S);const A=flarum.core.compat["common/utils/extract"];var G=t.n(A);function C(t,s,o,e){void 0===s&&(s={}),void 0===o&&(o=!0),void 0===e&&(e=!0),s.style=s.style||{},s.className="TagLabel "+(s.className||"");var a=G()(s,"link"),r=t?t.name():app.translator.trans("flarum-tags.lib.deleted_tag_text");if(t){var i=t.color();i&&(s.style["--tag-bg"]=i,s.className=_()(s.className,"colored",D()(i))),a&&(s.title=t.description()||"",s.href=app.route("tag",{tags:t.slug()})),t.isChild()&&(s.className+=" TagLabel--child")}else s.className+=" untagged";var n=null;if(t.isPasswordProtected()||t.isGroupProtected())if(t.isUnlocked()){if(!e)return m("[",null);t.isLockedIconDisplayed()&&(n=g()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}))}else{if(!o)return m("[",null);n=t.isPasswordProtected()?g()("fas fa-lock",{style:{fontSize:"13px",float:"none"}}):g()("fas fa-user-lock",{style:{fontSize:"13px",float:"none"}})}else if(!e)return m("[",null);return m(a?L():"span",s,m("span",{className:"TagLabel-text"},t&&t.icon()&&y()(t,{className:"TagLabel-icon"},{useColor:!1}),m("span",{className:"TagLabel-name"},r+(n?" ":""),n||null)))}const z=flarum.core.compat["common/components/Button"];var V=t.n(z);const q=flarum.core.compat["common/components/Placeholder"];var j=t.n(q);const B=flarum.core.compat["forum/components/PostsUserPage"];var M=t.n(B);const R=flarum.core.compat["forum/components/CommentPost"];var E=t.n(R);function H(t,s){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},H(t,s)}function J(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,H(t,s)}const K=flarum.core.compat["forum/components/ComposerPostPreview"];var Q=t.n(K);const W=flarum.core.compat["common/helpers/listItems"];var X=t.n(W),Y=function(t){function s(){return t.apply(this,arguments)||this}return J(s,t),s.prototype.content=function(){return this.attrs.post,this.attrs.post.discussion(),this.attrs.post.discussion().tags(),[m("header",{className:"Post-header"},m("ul",null,X()(this.headerItems().toArray()))),m("div",{className:"Post-body"},this.isEditing()?m(Q(),{className:"Post-preview",composer:app.composer}):m.trust(this.attrs.post.contentHtml()))]},s}(E()),Z=["link"];function $(t,s,o,e){void 0===s&&(s={}),void 0===o&&(o=!0),void 0===e&&(e=!0);var a=[],r=s,i=r.link,n=function(t,s){if(null==t)return{};var o,e,a={},r=Object.keys(t);for(e=0;e<r.length;e++)o=r[e],s.indexOf(o)>=0||(a[o]=t[o]);return a}(r,Z);return n.className=_()("TagsLabel",n.className),t?b()(t).forEach((function(s){(s||1===t.length)&&a.push(C(s,{link:i},o,e))})):a.push(C()),m("span",n,a)}var tt=function(t){function s(){return t.apply(this,arguments)||this}J(s,t);var o=s.prototype;return o.isLockedIconDisplayed=function(){return n().attribute("is_locked_icon_displayed").call(this)},o.isPasswordProtected=function(){return n().attribute("is_password_protected").call(this)},o.isGroupProtected=function(){return n().attribute("is_group_protected").call(this)},o.isUnlocked=function(){return n().attribute("is_unlocked").call(this)},s}(r());const st=flarum.core.compat["forum/components/DiscussionList"];var ot=t.n(st);const et=flarum.core.compat["forum/components/DiscussionListItem"];var at=t.n(et);const rt=flarum.core.compat["utils/DiscussionControls"];var it=t.n(rt);const nt=flarum.core.compat["common/components/Tooltip"];var ct=t.n(nt);const lt=flarum.core.compat["common/helpers/avatar"];var ut=t.n(lt);function dt(t,s,o,e,a){return m(ct(),{text:o,position:"bottom"},m("div",{className:"DiscussionListItem-main"},m("h2",{className:"DiscussionListItem-title"},e?g()("fas fa-lock"):m("[",null),a?g()("fas fa-user-lock"):m("[",null)," "+s),$(t.tags(),{},!0,!1),m("ul",{class:"DiscussionListItem-info"},m("li",{class:"item-tags"},$(t.tags(),{},!1)))))}var mt=function(t){function s(){return t.apply(this,arguments)||this}J(s,t);var o=s.prototype;return o.view=function(){var t=this.attrs.discussion,s=(t.tags(),it().controls(t,this).toArray(),this.elementAttrs());return t.isProtectedTagDisplayedForDiscussionList()?m("div",s,this.contentView()):m("div",null)},o.processCloudView=function(t){return m("div",{className:"TagCloud"},t.map((function(t){return[tagLabel(t,t.isProtectedTagDisplayedForTagsPage(),{link:!0})," "]})))},o.contentView=function(){var t=this.attrs.discussion,s=t.isUnread(),o=t.isRead();return m("div",{className:_()("DiscussionListItem-content","Slidable-content",{unread:s,read:o})},this.authorAvatarView(),this.badgesView(),this.mainView(),this.replyCountItem())},o.mainView=function(){var t=this.attrs.discussion,s=(this.getJumpTo(),t.protectedPasswordTags().length>0),o=t.protectedGroupPermissionTags().length>0;return s&&!o?m(L(),{className:"DiscussionListItem-main",href:"#"},dt(t,e().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.password_protected"),e().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.password_protected"),s,o)):!s&&o?m(L(),{className:"DiscussionListItem-main",href:"#"},dt(t,e().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.group_protected"),e().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.group_protected"),s,o)):m(L(),{className:"DiscussionListItem-main",href:"#"},dt(t,e().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.multiple"),e().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.multiple"),s,o))},o.authorAvatarView=function(){var t=this.attrs.discussion;if(t.isProtectedTagDisplayedForDiscussionAvator()){var s=t.user();return m(ct(),{text:e().translator.trans("core.forum.discussion_list.started_text",{user:s,ago:I()(t.createdAt())}),position:"right"},m(L(),{className:"DiscussionListItem-author",href:s?e().route.user(s):"#"},ut()(s||null,{title:""})))}return m(ct(),{text:e().translator.trans("core.forum.discussion_list.started_text",{ago:I()(t.createdAt())}),position:"right"},m(L(),{className:"DiscussionListItem-author",href:"#"},m("span",{class:"Avatar",loading:"lazy"},g()("fas fa-question"))))},s}(at());const pt=flarum.core.compat["forum/components/IndexPage"];var ft=t.n(pt);const gt=flarum.core.compat["common/Component"];var ht=t.n(gt);const vt=flarum.core.compat["common/utils/Stream"];var Pt=t.n(vt),yt=function(t){function s(){return t.apply(this,arguments)||this}J(s,t);var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),this.password=Pt()(""),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},o.view=function(){return m("div",{className:"TagPasswordRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,e().translator.trans("datlechin-tag-passwords.forum.tag_password_required.title")),m("input",{className:"FormControl"+(this.invalid?" invalid":""),bidi:this.password,disabled:this.loading})),m(V(),{type:"submit",className:"Button Button--primary",loading:this.loading},e().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},o.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,this.invalid=!1,e().request({url:e().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id(),password:this.password}}}).then((function(t){s.tag.pushAttributes({isUnlocked:!0}),s.loading=!1,s.invalid=!1,m.redraw()})).catch((function(t){s.invalid=!0,s.loading=!1}))},s}(ht()),Tt=function(t){function s(){return t.apply(this,arguments)||this}J(s,t);var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},o.view=function(){return m("div",{className:"TagGroupRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,e().translator.trans("datlechin-tag-passwords.forum.tag_group_required.title"))),m(V(),{type:"submit",className:"Button Button--primary",loading:this.loading},e().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},o.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,this.invalid=!1,e().request({url:e().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id()}}}).then((function(t){s.tag.pushAttributes({isUnlocked:!0}),s.loading=!1,s.invalid=!1,m.redraw()})).catch((function(t){s.invalid=!0,s.loading=!1}))},s}(ht());e().initializers.add("datlechin/flarum-tag-passwords",(function(){r().prototype.isPasswordProtected=n().attribute("isPasswordProtected"),r().prototype.isGroupProtected=n().attribute("isGroupProtected"),r().prototype.isUnlocked=n().attribute("isUnlocked"),r().prototype.password=n().attribute("password"),r().prototype.isLockedIconDisplayed=n().attribute("isLockedIconDisplayed"),r().prototype.isProtectedTagDisplayedForSidebar=n().attribute("isProtectedTagDisplayedForSidebar"),r().prototype.isProtectedTagDisplayedForTagsPage=n().attribute("isProtectedTagDisplayedForTagsPage"),l().prototype.protectedPasswordTags=n().attribute("protectedPasswordTags"),l().prototype.protectedGroupPermissionTags=n().attribute("protectedGroupPermissionTags"),l().prototype.numberOfProtectedTags=n().attribute("numberOfProtectedTags"),l().prototype.isProtectedTagDisplayedForDiscussionList=n().attribute("isProtectedTagDisplayedForDiscussionList"),l().prototype.isProtectedTagDisplayedForDiscussionAvator=n().attribute("isProtectedTagDisplayedForDiscussionAvator"),l().prototype.isProtectedTagDisplayedForPostList=n().attribute("isProtectedTagDisplayedForPostList"),(0,u.override)(ot().prototype,"view",(function(){var t,s=this.attrs.state,o=s.getParams(),a=s.isInitialLoading()||s.isLoadingNext();if(a?t=m(F(),null):s.hasNext()&&(t=m(V(),{className:"Button",onclick:s.loadNext.bind(s)},e().translator.trans("core.forum.discussion_list.load_more_button"))),s.isEmpty()){var r=e().translator.trans("core.forum.discussion_list.empty_text");return m("div",{className:"DiscussionList"},m(j(),{text:r}))}var i=s.pageSize;return m("div",{className:_()("DiscussionList",{"DiscussionList--searchResults":s.isSearchResults()})},m("ul",{role:"feed","aria-busy":a,className:"DiscussionList-discussions"},s.getPages().map((function(t,s){return t.items.map((function(t,e){return function(t,s,o,e,a){return t.numberOfProtectedTags()>0?m("li",{key:0,"data-id":0,role:"article","aria-setsize":"-1","aria-posinset":s*o+e},m(mt,{discussion:t,params:a})):m("li",{key:t.id(),"data-id":t.id(),role:"article","aria-setsize":"-1","aria-posinset":s*o+e},m(at(),{discussion:t,params:a}))}(t,s,i,e,o)}))}))),m("div",{className:"DiscussionList-loadMore"},t))})),function(){function t(t,s,o,e){o&&(s.isUnlocked()?s.isLockedIconDisplayed()&&t.children.push(g()("fas fa-unlock")):s.isProtectedTagDisplayedForSidebar()?t.children.push(e):t.attrs.className+=" hiddenTag")}(0,u.extend)(p().prototype,"view",(function(s){var o=this.attrs.model;t(s,o,o.isPasswordProtected(),g()("fas fa-lock")),t(s,o,o.isGroupProtected(),g()("fas fa-user-lock"))})),(0,u.override)(v().prototype,"tagTileView",(function(t){for(var s=arguments.length,o=new Array(s>1?s-1:0),a=1;a<s;a++)o[a-1]=arguments[a];if(o.length>0&&o[0]instanceof r()){var i=o[0];if(i.isUnlocked()||!i.isGroupProtected()&&!i.isPasswordProtected()||i.isProtectedTagDisplayedForTagsPage()){var n=b()(i.children()||[]);return m("li",{className:_()("TagTile",{colored:i.color()},D()(i.color())),style:{"--tag-bg":i.color()}},m(L(),{className:"TagTile-info",href:e().route.tag(i)},i.icon()&&y()(i,{},{useColor:!1}),function(t){return t.isGroupProtected()&&!t.isUnlocked()?m("div",{class:"TagsPageGroupProtection"}):t.isPasswordProtected()&&!t.isUnlocked()?m("div",{class:"TagsPagePasswordProtection"}):m("[",null)}(i),m("h3",{className:"TagTile-name"},i.name()),m("p",{className:"TagTile-description"},i.description()),!!n&&m("div",{className:"TagTile-children"},n.map((function(t){var s=null;if(t.isPasswordProtected())if(t.isUnlocked())t.isLockedIconDisplayed()&&(s=g()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}));else{if(!t.isProtectedTagDisplayedForTagsPage())return m("[",null);s=g()("fas fa-lock",{style:{fontSize:"13px",float:"none"}})}if(t.isGroupProtected())if(t.isUnlocked())t.isLockedIconDisplayed()&&(s=g()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}));else{if(!t.isProtectedTagDisplayedForTagsPage())return m("[",null);s=g()("fas fa-user-lock",{style:{fontSize:"13px",float:"none"}})}return[m(L(),{href:e().route.tag(t)},t.name()," ",s)," "]})))),m("span",{className:"TagTile-lastPostedDiscussion"},function(t){if(t.isGroupProtected()&&!t.isUnlocked())return m("div",null,g()("fas fa-user-lock")," ",e().translator.trans("datlechin-tag-passwords.forum.tags_page.group_protected"));if(t.isPasswordProtected()&&!t.isUnlocked())return m("div",null,g()("fas fa-lock")," ",e().translator.trans("datlechin-tag-passwords.forum.tags_page.password_protected"));var s=t.lastPostedDiscussion();if(s){if(s.numberOfProtectedTags()>0){var o=s.protectedPasswordTags(),a=o.length>0,r=s.protectedGroupPermissionTags(),i=r.length>0,n=o.concat(r);return m(L(),{className:"TagTile-lastPostedDiscussion",href:"/t/"+n[0].slug},m("span",{className:"TagTile-lastPostedDiscussion-title"},i?g()("fas fa-user-lock"):m("[",null),a?g()("fas fa-lock"):m("[",null),i&&a?e().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.multiple"):i?e().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.group_protected"):e().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.password_protected")),I()(s.lastPostedAt()))}return m(L(),{className:"TagTile-lastPostedDiscussion",href:e().route.discussion(s,s.lastPostNumber())},m("span",{className:"TagTile-lastPostedDiscussion-title"},s.title()),I()(s.lastPostedAt()))}return m("span",{className:"TagTile-lastPostedDiscussion"})}(i)))}return""}return t.apply(void 0,o)})),(0,u.override)(v().prototype,"contentItems",(function(){var t=new(O());if(this.loading)t.add("loading",m(F(),null));else{var s=this.tags.filter((function(t){return null!==t.position()})),o=this.tags.filter((function(t){return null===t.position()}));t.add("tagTiles",this.tagTileListView(s),100),o.length&&t.add("cloud",function(t){return m("div",{className:"TagCloud"},t.map((function(t){return[C(t,{link:!0},t.isProtectedTagDisplayedForTagsPage())," "]})))}(o),10)}return t}))}(),(0,u.override)(M().prototype,"content",(function(){return 0!==this.posts.length||this.loading?(this.loading?t=m(F(),null):this.moreResults&&(t=m("div",{className:"PostsUserPage-loadMore"},m(V(),{className:"Button",onclick:this.loadMore.bind(this)},e().translator.trans("core.forum.user.posts_load_more_button")))),m("div",{className:"PostsUserPage"},m("ul",{className:"PostsUserPage-list"},this.posts.map((function(t){var s=t.discussion();if(s.numberOfProtectedTags()>0){if(s.isProtectedTagDisplayedForPostList()){var o=function(t){for(var s=[],o=0;o<t.length;o++){var e=new tt;e.pushAttributes(t[o]),s.push(e)}return s}(s.protectedPasswordTags().concat(s.protectedGroupPermissionTags()));return m("li",null,m("div",{className:"PostsUserPage-discussion"},$(o,{},!0,!1),e().translator.trans("core.forum.user.in_discussion_text",{discussion:m(L(),{href:"#"})})),m(Y,{post:t}))}return m("[",null)}return m("li",null,m("div",{className:"PostsUserPage-discussion"},e().translator.trans("core.forum.user.in_discussion_text",{discussion:m(L(),{href:e().route.post(t)},s.title())})),m(E(),{post:t}))}))),m("div",{className:"PostsUserPage-loadMore"},t))):m("div",{className:"PostsUserPage"},m(j(),{text:e().translator.trans("core.forum.user.posts_empty_text")}));var t})),function(){function t(s,o,e,a){s.children.forEach((function(s){if(s.attrs.className&&-1!==s.attrs.className.indexOf(o[e]))return(e+=1)==o.length?void(s.children=a):t(s,o,e,a)}))}(0,u.extend)(ft().prototype,"view",(function(s){var o=this.currentTag();o&&!o.isUnlocked()&&(o.isGroupProtected()?t(s,["container","sideNavContainer","IndexPage-results"],0,[Tt.component({currentTag:o})]):o.isPasswordProtected()&&t(s,["container","sideNavContainer","IndexPage-results"],0,[yt.component({currentTag:o})]))}))}()}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map