(()=>{var t={n:s=>{var o=s&&s.__esModule?()=>s.default:()=>s;return t.d(o,{a:o}),o},d:(s,o)=>{for(var e in o)t.o(o,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:o[e]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s);const o=flarum.core.compat["forum/app"];var e=t.n(o);const a=flarum.core.compat["tags/models/Tag"];var r=t.n(a);const i=flarum.core.compat["common/Model"];var n=t.n(i);const c=flarum.core.compat["common/models/Discussion"];var l=t.n(c);const u=flarum.core.compat["common/models/Post"];var d=t.n(u);const p=flarum.core.compat["common/extend"],f=flarum.core.compat["tags/components/TagLinkButton"];var g=t.n(f);const h=flarum.core.compat["common/helpers/icon"];var v=t.n(h);const P=flarum.core.compat["tags/components/TagsPage"];var y=t.n(P);const T=flarum.core.compat["tags/common/helpers/tagIcon"];var w=t.n(T);const b=flarum.core.compat["tags/common/utils/sortTags"];var _=t.n(b);const D=flarum.core.compat["common/utils/classList"];var N=t.n(D);const k=flarum.core.compat["common/helpers/textContrastClass"];var L=t.n(k);const x=flarum.core.compat["common/components/Link"];var I=t.n(x);const F=flarum.core.compat["common/helpers/humanTime"];var U=t.n(F);const S=flarum.core.compat["common/components/LoadingIndicator"];var A=t.n(S);const O=flarum.core.compat["common/utils/ItemList"];var G=t.n(O);const C=flarum.core.compat["common/utils/extract"];var z=t.n(C);function q(t,s,o,e){void 0===s&&(s={}),void 0===o&&(o=!0),void 0===e&&(e=!0),s.style=s.style||{},s.className="TagLabel "+(s.className||"");var a=z()(s,"link"),r=t?t.name():app.translator.trans("flarum-tags.lib.deleted_tag_text");if(t){var i=t.color();i&&(s.style["--tag-bg"]=i,s.className=N()(s.className,"colored",L()(i))),a&&(s.title=t.description()||"",s.href=app.route("tag",{tags:t.slug()})),t.isChild()&&(s.className+=" TagLabel--child")}else s.className+=" untagged";var n=null;if(t.isPasswordProtected()||t.isGroupProtected())if(t.isUnlocked()){if(!e)return m("[",null);t.isLockedIconDisplayed()&&(n=v()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}))}else{if(!o)return m("[",null);n=t.isPasswordProtected()?v()("fas fa-lock",{style:{fontSize:"13px",float:"none"}}):v()("fas fa-user-lock",{style:{fontSize:"13px",float:"none"}})}else if(!e)return m("[",null);return m(a?I():"span",s,m("span",{className:"TagLabel-text"},t&&t.icon()&&w()(t,{className:"TagLabel-icon"},{useColor:!1}),m("span",{className:"TagLabel-name"},r+(n?" ":""),n||null)))}const V=flarum.core.compat["common/components/Button"];var B=t.n(V);const j=flarum.core.compat["common/components/Placeholder"];var M=t.n(j);const R=flarum.core.compat["forum/components/PostsUserPage"];var H=t.n(R);const E=flarum.core.compat["forum/components/CommentPost"];var J=t.n(E);function K(t,s){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},K(t,s)}function Q(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,K(t,s)}var W=function(t){function s(){return t.apply(this,arguments)||this}Q(s,t);var o=s.prototype;return o.isLockedIconDisplayed=function(){return n().attribute("is_locked_icon_displayed").call(this)},o.isPasswordProtected=function(){return n().attribute("is_password_protected").call(this)},o.isGroupProtected=function(){return n().attribute("is_group_protected").call(this)},o.isUnlocked=function(){return n().attribute("is_unlocked").call(this)},s}(r());const X=flarum.core.compat["common/components/Tooltip"];var Y=t.n(X),Z=["link"];function $(t,s,o,e){void 0===s&&(s={}),void 0===o&&(o=!0),void 0===e&&(e=!0);var a=[],r=s,i=r.link,n=function(t,s){if(null==t)return{};var o,e,a={},r=Object.keys(t);for(e=0;e<r.length;e++)o=r[e],s.indexOf(o)>=0||(a[o]=t[o]);return a}(r,Z);return n.className=N()("TagsLabel",n.className),t?_()(t).forEach((function(s){(s||1===t.length)&&a.push(q(s,{link:i},o,e))})):a.push(q()),m("span",n,a)}function tt(t,s,o,e,a,r){return void 0===r&&(r=t.tags()),m(Y(),{text:o,position:"bottom"},m("div",{className:"DiscussionListItem-main"},m("h2",{className:"DiscussionListItem-title"},e?v()("fas fa-lock"):m("[",null),a?v()("fas fa-user-lock"):m("[",null)," "+s),$(r,{},!0,!1),m("ul",{class:"DiscussionListItem-info"},m("li",{class:"item-tags"},$(r,{},!1)))))}const st=flarum.core.compat["forum/components/DiscussionList"];var ot=t.n(st);const et=flarum.core.compat["forum/components/DiscussionListItem"];var at=t.n(et);const rt=flarum.core.compat["utils/DiscussionControls"];var it=t.n(rt);const nt=flarum.core.compat["common/helpers/avatar"];var ct=t.n(nt),lt=function(t){function s(){return t.apply(this,arguments)||this}Q(s,t);var o=s.prototype;return o.view=function(){var t=this.attrs.discussion,s=(t.tags(),it().controls(t,this).toArray(),this.elementAttrs());return t.isProtectedTagDisplayedForDiscussionList()?m("div",s,this.contentView()):m("div",null)},o.processCloudView=function(t){return m("div",{className:"TagCloud"},t.map((function(t){return[tagLabel(t,t.isProtectedTagDisplayedForTagsPage(),{link:!0})," "]})))},o.contentView=function(){var t=this.attrs.discussion,s=t.isUnread(),o=t.isRead();return m("div",{className:N()("DiscussionListItem-content","Slidable-content",{unread:s,read:o})},this.authorAvatarView(),this.badgesView(),this.mainView(),this.replyCountItem())},o.mainView=function(){var t=this.attrs.discussion,s=(this.getJumpTo(),t.protectedPasswordTags().length>0),o=t.protectedGroupPermissionTags().length>0,a=e().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.multiple"),r=e().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.multiple");return s&&!o?(a=e().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.password_protected"),r=e().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.password_protected")):!s&&o&&(a=e().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.group_protected"),r=e().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.group_protected")),m(I(),{className:"DiscussionListItem-main",href:"#"},tt(t,a,r,s,o))},o.authorAvatarView=function(){var t=this.attrs.discussion;if(t.isProtectedTagDisplayedForDiscussionAvator()){var s=t.user();return m(Y(),{text:e().translator.trans("core.forum.discussion_list.started_text",{user:s,ago:U()(t.createdAt())}),position:"right"},m(I(),{className:"DiscussionListItem-author",href:s?e().route.user(s):"#"},ct()(s||null,{title:""})))}return m(Y(),{text:e().translator.trans("core.forum.discussion_list.started_text",{ago:U()(t.createdAt())}),position:"right"},m(I(),{className:"DiscussionListItem-author",href:"#"},m("span",{class:"Avatar",loading:"lazy"},v()("fas fa-question"))))},s}(at());const ut=flarum.core.compat["forum/components/IndexPage"];var dt=t.n(ut);const mt=flarum.core.compat["common/Component"];var pt=t.n(mt);const ft=flarum.core.compat["common/utils/Stream"];var gt=t.n(ft),ht=function(t){function s(){return t.apply(this,arguments)||this}Q(s,t);var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),this.password=gt()(""),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},o.view=function(){return m("div",{className:"TagPasswordRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,e().translator.trans("datlechin-tag-passwords.forum.tag_password_required.title")),m("input",{className:"FormControl"+(this.invalid?" invalid":""),bidi:this.password,disabled:this.loading})),m(B(),{type:"submit",className:"Button Button--primary",loading:this.loading},e().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},o.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,this.invalid=!1,e().request({url:e().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id(),password:this.password}}}).then((function(t){s.tag.pushAttributes({isUnlocked:!0}),s.loading=!1,s.invalid=!1,m.redraw()})).catch((function(t){s.invalid=!0,s.loading=!1}))},s}(pt()),vt=function(t){function s(){return t.apply(this,arguments)||this}Q(s,t);var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},o.view=function(){return m("div",{className:"TagGroupRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,e().translator.trans("datlechin-tag-passwords.forum.tag_group_required.title"))),m(B(),{type:"submit",className:"Button Button--primary",loading:this.loading},e().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},o.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,this.invalid=!1,e().request({url:e().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id()}}}).then((function(t){s.tag.pushAttributes({isUnlocked:!0}),s.loading=!1,s.invalid=!1,m.redraw()})).catch((function(t){s.invalid=!0,s.loading=!1}))},s}(pt());const Pt=flarum.core.compat["forum/components/DiscussionPage"];var yt=t.n(Pt);const Tt=flarum.core.compat["forum/components/DiscussionHero"];var wt=t.n(Tt);const bt=flarum.core.compat["common/helpers/listItems"];var _t=t.n(bt),Dt=function(t){function s(){return t.apply(this,arguments)||this}Q(s,t);var o=s.prototype;return o.view=function(){return this.attrs.discussion.tags(),m("header",{className:"Hero DiscussionHero"},m("div",{className:"container"},m("ul",{className:"DiscussionHero-items"},_t()(this.items().toArray()))))},o.items=function(){var t=new(G()),s=this.attrs.discussion,o=s.tags();t.add("tags",$(o,{},!1));var a=s.protectedPasswordTags().length>0,r=s.protectedGroupPermissionTags().length>0,i=e().translator.trans("datlechin-tag-passwords.forum.discussion_page.title.multiple");return a&&!r?i=e().translator.trans("datlechin-tag-passwords.forum.discussion_page.title.password_protected"):!a&&r&&(i=e().translator.trans("datlechin-tag-passwords.forum.discussion_page.title.group_protected")),t.add("title",m("h2",{className:"DiscussionHero-title"},i)),t.add("tags-protected",$(o,{link:!0},!0,!1)),t},s}(wt());const Nt=flarum.core.compat["forum/states/PostStreamState"];var kt=t.n(Nt);e().initializers.add("datlechin/flarum-tag-passwords",(function(){d().prototype.isUnlocked=n().attribute("isUnlocked"),r().prototype.isPasswordProtected=n().attribute("isPasswordProtected"),r().prototype.isGroupProtected=n().attribute("isGroupProtected"),r().prototype.isUnlocked=n().attribute("isUnlocked"),r().prototype.password=n().attribute("password"),r().prototype.isLockedIconDisplayed=n().attribute("isLockedIconDisplayed"),r().prototype.isProtectedTagDisplayedForSidebar=n().attribute("isProtectedTagDisplayedForSidebar"),r().prototype.isProtectedTagDisplayedForTagsPage=n().attribute("isProtectedTagDisplayedForTagsPage"),l().prototype.protectedPasswordTags=n().attribute("protectedPasswordTags"),l().prototype.protectedGroupPermissionTags=n().attribute("protectedGroupPermissionTags"),l().prototype.numberOfProtectedTags=n().attribute("numberOfProtectedTags"),l().prototype.isProtectedTagDisplayedForDiscussionList=n().attribute("isProtectedTagDisplayedForDiscussionList"),l().prototype.isProtectedTagDisplayedForDiscussionAvator=n().attribute("isProtectedTagDisplayedForDiscussionAvator"),l().prototype.isProtectedTagDisplayedForPostList=n().attribute("isProtectedTagDisplayedForPostList"),l().prototype.isProtectedTagDisplayedForDiscussionPage=n().attribute("isProtectedTagDisplayedForDiscussionPage"),(0,p.override)(ot().prototype,"view",(function(){var t,s=this.attrs.state,o=s.getParams(),a=s.isInitialLoading()||s.isLoadingNext();if(a?t=m(A(),null):s.hasNext()&&(t=m(B(),{className:"Button",onclick:s.loadNext.bind(s)},e().translator.trans("core.forum.discussion_list.load_more_button"))),s.isEmpty()){var r=e().translator.trans("core.forum.discussion_list.empty_text");return m("div",{className:"DiscussionList"},m(M(),{text:r}))}var i=s.pageSize;return m("div",{className:N()("DiscussionList",{"DiscussionList--searchResults":s.isSearchResults()})},m("ul",{role:"feed","aria-busy":a,className:"DiscussionList-discussions"},s.getPages().map((function(t,s){return t.items.map((function(t,e){return function(t,s,o,e,a){return t.numberOfProtectedTags()>0?m("li",{key:0,"data-id":0,role:"article","aria-setsize":"-1","aria-posinset":s*o+e},m(lt,{discussion:t,params:a})):m("li",{key:t.id(),"data-id":t.id(),role:"article","aria-setsize":"-1","aria-posinset":s*o+e},m(at(),{discussion:t,params:a}))}(t,s,i,e,o)}))}))),m("div",{className:"DiscussionList-loadMore"},t))})),function(){function t(t,s,o,e){o&&(s.isUnlocked()?s.isLockedIconDisplayed()&&t.children.push(v()("fas fa-unlock")):s.isProtectedTagDisplayedForSidebar()?t.children.push(e):t.attrs.className+=" hiddenTag")}(0,p.extend)(g().prototype,"view",(function(s){var o=this.attrs.model;t(s,o,o.isPasswordProtected(),v()("fas fa-lock")),t(s,o,o.isGroupProtected(),v()("fas fa-user-lock"))})),(0,p.override)(y().prototype,"tagTileView",(function(t){for(var s=arguments.length,o=new Array(s>1?s-1:0),a=1;a<s;a++)o[a-1]=arguments[a];if(o.length>0&&o[0]instanceof r()){var i=o[0];if(i.isUnlocked()||!i.isGroupProtected()&&!i.isPasswordProtected()||i.isProtectedTagDisplayedForTagsPage()){var n=_()(i.children()||[]);return m("li",{className:N()("TagTile",{colored:i.color()},L()(i.color())),style:{"--tag-bg":i.color()}},m(I(),{className:"TagTile-info",href:e().route.tag(i)},i.icon()&&w()(i,{},{useColor:!1}),function(t){return t.isGroupProtected()&&!t.isUnlocked()?m("div",{class:"TagsPageGroupProtection"}):t.isPasswordProtected()&&!t.isUnlocked()?m("div",{class:"TagsPagePasswordProtection"}):m("[",null)}(i),m("h3",{className:"TagTile-name"},i.name()),m("p",{className:"TagTile-description"},i.description()),!!n&&m("div",{className:"TagTile-children"},n.map((function(t){var s=null;if(t.isPasswordProtected())if(t.isUnlocked())t.isLockedIconDisplayed()&&(s=v()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}));else{if(!t.isProtectedTagDisplayedForTagsPage())return m("[",null);s=v()("fas fa-lock",{style:{fontSize:"13px",float:"none"}})}if(t.isGroupProtected())if(t.isUnlocked())t.isLockedIconDisplayed()&&(s=v()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}));else{if(!t.isProtectedTagDisplayedForTagsPage())return m("[",null);s=v()("fas fa-user-lock",{style:{fontSize:"13px",float:"none"}})}return[m(I(),{href:e().route.tag(t)},t.name()," ",s)," "]})))),m("span",{className:"TagTile-lastPostedDiscussion"},function(t){if(t.isGroupProtected()&&!t.isUnlocked())return m("div",null,v()("fas fa-user-lock")," ",e().translator.trans("datlechin-tag-passwords.forum.tags_page.group_protected"));if(t.isPasswordProtected()&&!t.isUnlocked())return m("div",null,v()("fas fa-lock")," ",e().translator.trans("datlechin-tag-passwords.forum.tags_page.password_protected"));var s=t.lastPostedDiscussion();if(s){if(s.numberOfProtectedTags()>0){var o=s.protectedPasswordTags(),a=o.length>0,r=s.protectedGroupPermissionTags(),i=r.length>0,n=o.concat(r);return m(I(),{className:"TagTile-lastPostedDiscussion",href:"/t/"+n[0].slug},m("span",{className:"TagTile-lastPostedDiscussion-title"},i?v()("fas fa-user-lock"):m("[",null),a?v()("fas fa-lock"):m("[",null),i&&a?e().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.multiple"):i?e().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.group_protected"):e().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.password_protected")),U()(s.lastPostedAt()))}return m(I(),{className:"TagTile-lastPostedDiscussion",href:e().route.discussion(s,s.lastPostNumber())},m("span",{className:"TagTile-lastPostedDiscussion-title"},s.title()),U()(s.lastPostedAt()))}return m("span",{className:"TagTile-lastPostedDiscussion"})}(i)))}return""}return t.apply(void 0,o)})),(0,p.override)(y().prototype,"contentItems",(function(){var t=new(G());if(this.loading)t.add("loading",m(A(),null));else{var s=this.tags.filter((function(t){return null!==t.position()})),o=this.tags.filter((function(t){return null===t.position()}));t.add("tagTiles",this.tagTileListView(s),100),o.length&&t.add("cloud",function(t){return m("div",{className:"TagCloud"},t.map((function(t){return[q(t,{link:!0},t.isProtectedTagDisplayedForTagsPage())," "]})))}(o),10)}return t}))}(),(0,p.override)(H().prototype,"content",(function(){return 0!==this.posts.length||this.loading?(this.loading?t=m(A(),null):this.moreResults&&(t=m("div",{className:"PostsUserPage-loadMore"},m(B(),{className:"Button",onclick:this.loadMore.bind(this)},e().translator.trans("core.forum.user.posts_load_more_button")))),m("div",{className:"PostsUserPage"},m("ul",{className:"PostsUserPage-list"},this.posts.map((function(t){var s=t.discussion();if(s.numberOfProtectedTags()>0){if(s.isProtectedTagDisplayedForPostList()){var o=function(t){for(var s=[],o=0;o<t.length;o++){var e=new W;e.pushAttributes(t[o]),s.push(e)}return s}(s.protectedPasswordTags().concat(s.protectedGroupPermissionTags())),a=s.protectedPasswordTags().length>0,r=s.protectedGroupPermissionTags().length>0;return m("li",null,function(t,s,o,a){var r=e().translator.trans("datlechin-tag-passwords.forum.post_list.title.multiple"),i=e().translator.trans("datlechin-tag-passwords.forum.post_list.info.multiple");return s&&!o?(r=e().translator.trans("datlechin-tag-passwords.forum.post_list.title.password_protected"),i=e().translator.trans("datlechin-tag-passwords.forum.post_list.info.password_protected")):!s&&o&&(r=e().translator.trans("datlechin-tag-passwords.forum.post_list.title.group_protected"),i=e().translator.trans("datlechin-tag-passwords.forum.post_list.info.group_protected")),tt(t,r,i,s,o,a)}(s,a,r,o))}return m("[",null)}return m("li",null,m("div",{className:"PostsUserPage-discussion"},e().translator.trans("core.forum.user.in_discussion_text",{discussion:m(I(),{href:e().route.post(t)},s.title())})),m(J(),{post:t}))}))),m("div",{className:"PostsUserPage-loadMore"},t))):m("div",{className:"PostsUserPage"},m(M(),{text:e().translator.trans("core.forum.user.posts_empty_text")}));var t})),function(){function t(s,o,e,a){s.children.forEach((function(s){if(s.attrs.className&&-1!==s.attrs.className.indexOf(o[e]))return(e+=1)==o.length?void(s.children=a):t(s,o,e,a)}))}(0,p.extend)(dt().prototype,"view",(function(s){var o=this.currentTag();o&&!o.isUnlocked()&&(o.isGroupProtected()?t(s,["container","sideNavContainer","IndexPage-results"],0,[vt.component({currentTag:o})]):o.isPasswordProtected()&&t(s,["container","sideNavContainer","IndexPage-results"],0,[ht.component({currentTag:o})]))}))}(),function(){function t(t){var s=this;if(e().setTitleCount(0),t.isProtectedTagDisplayedForDiscussionPage()){var o,a;e().history.push("discussion",t.title()),e().setTitle(t.title());var r=[];if(t.payload&&t.payload.included){var i=t.id();r=t.payload.included.filter((function(t){return"posts"===t.type&&t.relationships&&t.relationships.discussion&&!Array.isArray(t.relationships.discussion.data)&&t.relationships.discussion.data.id===i})).map((function(t){return e().store.getById("posts",t.id)})).sort((function(t,s){return t.number()-s.number()})).slice(0,20)}this.stream=new(kt())(t,r);var n=m.route.param("near"),c="reply"===n?"reply":parseInt(n);this.stream.goToNumber(c||(null!=(o=null==(a=r[0])?void 0:a.number())?o:0),!0).then((function(){s.discussion=t,e().current.set("discussion",t),e().current.set("stream",s.stream)}))}else{e().history.push("discussion","test"),e().setTitle("test"),this.stream=new(kt())(t,[]);var l=m.route.param("near"),u="reply"===l?"reply":parseInt(l);this.stream.goToNumber(u||0,!0).then((function(){s.discussion=t,e().current.set("discussion",t),e().current.set("stream",s.stream)}))}}(0,p.override)(yt().prototype,"pageContent",(function(){var t=new(G());return t.add("hero",this.hero(),100),this.discussion.isProtectedTagDisplayedForDiscussionPage()&&t.add("main",m("div",{className:"container"},this.mainContent().toArray()),10),t})),(0,p.override)(yt().prototype,"hero",(function(){return this.discussion.isProtectedTagDisplayedForDiscussionPage()?m(wt(),{discussion:this.discussion}):m(Dt,{discussion:this.discussion})})),(0,p.override)(yt().prototype,"load",(function(){var s=e().preloadedApiDocument();if(s)setTimeout(t.bind(this,s),0);else{var o=this.requestParams();e().store.find("discussions",m.route.param("id"),o).then(t.bind(this))}m.redraw()}))}()}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map