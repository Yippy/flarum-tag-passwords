(()=>{var t={n:o=>{var r=o&&o.__esModule?()=>o.default:()=>o;return t.d(r,{a:r}),r},d:(o,r)=>{for(var e in r)t.o(r,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:r[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o);const r=flarum.core.compat["forum/app"];var e=t.n(r);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["tags/models/Tag"];var s=t.n(a);const i=flarum.core.compat["common/Model"];var c=t.n(i);const d=flarum.core.compat["forum/components/IndexPage"];var u=t.n(d);const l=flarum.core.compat["tags/components/TagLinkButton"];var p=t.n(l);const f=flarum.core.compat["common/helpers/icon"];var h=t.n(f);function g(t,o){return g=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t},g(t,o)}const v=flarum.core.compat["common/Component"];var b=t.n(v);const y=flarum.core.compat["common/utils/Stream"];var w=t.n(y);const P=flarum.core.compat["common/components/Button"];var _=t.n(P),T=function(t){var o,r;function n(){return t.apply(this,arguments)||this}r=t,(o=n).prototype=Object.create(r.prototype),o.prototype.constructor=o,g(o,r);var a=n.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o),this.password=w()(""),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},a.view=function(){return m("div",{className:"TagPasswordRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,e().translator.trans("datlechin-tag-passwords.forum.tag_password_required.title")),m("input",{className:"FormControl"+(this.invalid?" invalid":""),bidi:this.password,disabled:this.loading})),m(_(),{type:"submit",className:"Button Button--primary",loading:this.loading},e().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},a.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0,this.invalid=!1,e().request({url:e().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id(),password:this.password}}}).then((function(t){o.tag.pushAttributes({isUnlocked:!0}),o.loading=!1,o.invalid=!1,m.redraw()})).catch((function(t){o.invalid=!0,o.loading=!1}))},n}(b());e().initializers.add("datlechin/flarum-tag-passwords",(function(){s().prototype.isPasswordProtected=c().attribute("isPasswordProtected"),s().prototype.isUnlocked=c().attribute("isUnlocked"),s().prototype.password=c().attribute("password"),(0,n.extend)(u().prototype,"view",(function(t){var o=this.currentTag();o&&o.isPasswordProtected()&&!o.isUnlocked()&&(t.children[1].children[0].children[1].children=[T.component({currentTag:o})])})),(0,n.extend)(u().prototype,"sidebarItems",(function(t){var o=this.currentTag();if(o&&o.isPasswordProtected()&&!o.isUnlocked()){var r=t.get("newDiscussion");r.children=e().translator.trans("core.forum.index.cannot_start_discussion_button"),r.attrs.disabled=!0}})),(0,n.extend)(p().prototype,"view",(function(t){var o=this.attrs.model;o.isPasswordProtected()&&!o.isUnlocked()&&t.children.push(h()("fas fa-lock"))}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map