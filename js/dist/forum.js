(()=>{var t={n:s=>{var a=s&&s.__esModule?()=>s.default:()=>s;return t.d(a,{a}),a},d:(s,a)=>{for(var o in a)t.o(a,o)&&!t.o(s,o)&&Object.defineProperty(s,o,{enumerable:!0,get:a[o]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s);const a=flarum.core.compat["forum/app"];var o=t.n(a);const e=flarum.core.compat["common/extend"],r=flarum.core.compat["tags/models/Tag"];var i=t.n(r);const n=flarum.core.compat["common/Model"];var c=t.n(n);const l=flarum.core.compat["common/models/Discussion"];var u=t.n(l);const d=flarum.core.compat["forum/components/IndexPage"];var p=t.n(d);const f=flarum.core.compat["tags/components/TagLinkButton"];var g=t.n(f);const h=flarum.core.compat["common/helpers/icon"];var v=t.n(h);function P(t,s){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},P(t,s)}function y(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,P(t,s)}const T=flarum.core.compat["common/Component"];var b=t.n(T);const w=flarum.core.compat["common/utils/Stream"];var N=t.n(w);const D=flarum.core.compat["common/components/Button"];var _=t.n(D),k=function(t){function s(){return t.apply(this,arguments)||this}y(s,t);var a=s.prototype;return a.oninit=function(s){t.prototype.oninit.call(this,s),this.password=N()(""),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},a.view=function(){return m("div",{className:"TagPasswordRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,o().translator.trans("datlechin-tag-passwords.forum.tag_password_required.title")),m("input",{className:"FormControl"+(this.invalid?" invalid":""),bidi:this.password,disabled:this.loading})),m(_(),{type:"submit",className:"Button Button--primary",loading:this.loading},o().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},a.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,this.invalid=!1,o().request({url:o().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id(),password:this.password}}}).then((function(t){s.tag.pushAttributes({isUnlocked:!0}),s.loading=!1,s.invalid=!1,m.redraw()})).catch((function(t){s.invalid=!0,s.loading=!1}))},s}(b()),L=function(t){function s(){return t.apply(this,arguments)||this}y(s,t);var a=s.prototype;return a.oninit=function(s){t.prototype.oninit.call(this,s),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},a.view=function(){return m("div",{className:"TagGroupRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,o().translator.trans("datlechin-tag-passwords.forum.tag_group_required.title"))),m(_(),{type:"submit",className:"Button Button--primary",loading:this.loading},o().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},a.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,this.invalid=!1,o().request({url:o().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id()}}}).then((function(t){s.tag.pushAttributes({isUnlocked:!0}),s.loading=!1,s.invalid=!1,m.redraw()})).catch((function(t){s.invalid=!0,s.loading=!1}))},s}(b());const x=flarum.core.compat["tags/components/TagsPage"];var I=t.n(x);const S=flarum.core.compat["tags/common/helpers/tagIcon"];var O=t.n(S);const U=flarum.core.compat["tags/common/utils/sortTags"];var F=t.n(U);const G=flarum.core.compat["common/utils/classList"];var A=t.n(G);const C=flarum.core.compat["common/helpers/textContrastClass"];var z=t.n(C);const V=flarum.core.compat["common/components/Link"];var q=t.n(V);const j=flarum.core.compat["common/helpers/humanTime"];var B=t.n(j);const M=flarum.core.compat["forum/components/DiscussionList"];var R=t.n(M);const E=flarum.core.compat["forum/components/DiscussionListItem"];var J=t.n(E);const H=flarum.core.compat["common/components/LoadingIndicator"];var K=t.n(H);const Q=flarum.core.compat["common/components/Placeholder"];var W=t.n(Q);const X=flarum.core.compat["utils/DiscussionControls"];var Y=t.n(X);const Z=flarum.core.compat["common/components/Tooltip"];var $=t.n(Z);const tt=flarum.core.compat["common/helpers/avatar"];var st=t.n(tt);const at=flarum.core.compat["common/utils/extract"];var ot=t.n(at);function et(t,s,a,o){void 0===s&&(s={}),void 0===a&&(a=!0),void 0===o&&(o=!0),s.style=s.style||{},s.className="TagLabel "+(s.className||"");var e=ot()(s,"link"),r=t?t.name():app.translator.trans("flarum-tags.lib.deleted_tag_text");if(t){var i=t.color();i&&(s.style["--tag-bg"]=i,s.className=A()(s.className,"colored",z()(i))),e&&(s.title=t.description()||"",s.href=app.route("tag",{tags:t.slug()})),t.isChild()&&(s.className+=" TagLabel--child")}else s.className+=" untagged";var n=null;if(t.isPasswordProtected()||t.isGroupProtected())if(t.isUnlocked()){if(!o)return m("[",null);t.isLockedIconDisplayed()&&(n=v()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}))}else{if(!a)return m("[",null);n=t.isPasswordProtected()?v()("fas fa-lock",{style:{fontSize:"13px",float:"none"}}):v()("fas fa-user-lock",{style:{fontSize:"13px",float:"none"}})}else if(!o)return m("[",null);return m(e?q():"span",s,m("span",{className:"TagLabel-text"},t&&t.icon()&&O()(t,{className:"TagLabel-icon"},{useColor:!1}),m("span",{className:"TagLabel-name"},r+(n?" ":""),n||null)))}var rt=["link"];function it(t,s,a,o){void 0===s&&(s={}),void 0===a&&(a=!0),void 0===o&&(o=!0);var e=[],r=s,i=r.link,n=function(t,s){if(null==t)return{};var a,o,e={},r=Object.keys(t);for(o=0;o<r.length;o++)a=r[o],s.indexOf(a)>=0||(e[a]=t[a]);return e}(r,rt);return n.className=A()("TagsLabel",n.className),t?F()(t).forEach((function(s){(s||1===t.length)&&e.push(et(s,{link:i},a,o))})):e.push(et()),m("span",n,e)}function nt(t,s,a,o,e){return m($(),{text:a,position:"bottom"},m("div",{className:"DiscussionListItem-main"},m("h2",{className:"DiscussionListItem-title"},o?v()("fas fa-lock"):m("[",null),e?v()("fas fa-user-lock"):m("[",null)," "+s),it(t.tags(),{},!0,!1),m("ul",{class:"DiscussionListItem-info"},m("li",{class:"item-tags"},it(t.tags(),{},!1)))))}var ct=function(t){function s(){return t.apply(this,arguments)||this}y(s,t);var a=s.prototype;return a.view=function(){var t=this.attrs.discussion,s=(t.tags(),Y().controls(t,this).toArray(),this.elementAttrs());return this.attrs.params.displayProtectedTagForDiscussionList?m("div",s,this.contentView()):m("div",null)},a.processCloudView=function(t){return m("div",{className:"TagCloud"},t.map((function(t){return[tagLabel(t,t.isProtectedTagDisplayedForTagsPage(),{link:!0})," "]})))},a.contentView=function(){var t=this.attrs.discussion,s=t.isUnread(),a=t.isRead();return m("div",{className:A()("DiscussionListItem-content","Slidable-content",{unread:s,read:a})},this.authorAvatarView(),this.badgesView(),this.mainView(),this.replyCountItem())},a.mainView=function(){var t=this.attrs.discussion,s=(this.getJumpTo(),t.protectedPasswordTags().length>0),a=t.protectedGroupPermissionTags().length>0;return s&&!a?m(q(),{className:"DiscussionListItem-main"},nt(t,o().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.password_protected"),o().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.password_protected"),s,a)):!s&&a?m(q(),{className:"DiscussionListItem-main"},nt(t,o().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.group_protected"),o().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.group_protected"),s,a)):m(q(),{className:"DiscussionListItem-main"},nt(t,o().translator.trans("datlechin-tag-passwords.forum.discussion_list.title.multiple"),o().translator.trans("datlechin-tag-passwords.forum.discussion_list.info.multiple"),s,a))},a.authorAvatarView=function(){var t=this.attrs.discussion;if(this.attrs.params.displayDiscussionAvator){var s=t.user();return m($(),{text:o().translator.trans("core.forum.discussion_list.started_text",{user:s,ago:B()(t.createdAt())}),position:"right"},m(q(),{className:"DiscussionListItem-author",href:s?o().route.user(s):"#"},st()(s||null,{title:""})))}return m($(),{text:o().translator.trans("core.forum.discussion_list.started_text",{ago:B()(t.createdAt())}),position:"right"},m(q(),{className:"DiscussionListItem-author"},m("span",{class:"Avatar",loading:"lazy"},v()("fas fa-question"))))},s}(J());const lt=flarum.core.compat["common/utils/ItemList"];var ut=t.n(lt);function dt(t,s,a,o){t.children.forEach((function(t){if(t.attrs.className&&-1!==t.attrs.className.indexOf(s[a]))return(a+=1)==s.length?void(t.children=o):dt(t,s,a,o)}))}function mt(t,s,a,o){a&&(s.isUnlocked()?s.isLockedIconDisplayed()&&t.children.push(v()("fas fa-unlock")):s.isProtectedTagDisplayedForSidebar()?t.children.push(o):t.attrs.className+=" hiddenTag")}function pt(){var t,s=this.attrs.state,a=s.getParams(),e=s.isInitialLoading()||s.isLoadingNext();if(e?t=m(K(),null):s.hasNext()&&(t=m(_(),{className:"Button",onclick:s.loadNext.bind(s)},o().translator.trans("core.forum.discussion_list.load_more_button"))),s.isEmpty()){var r=o().translator.trans("core.forum.discussion_list.empty_text");return m("div",{className:"DiscussionList"},m(W(),{text:r}))}var i=s.pageSize;return m("div",{className:A()("DiscussionList",{"DiscussionList--searchResults":s.isSearchResults()})},m("ul",{role:"feed","aria-busy":e,className:"DiscussionList-discussions"},s.getPages().map((function(t,s){return t.items.map((function(t,e){return function(t,s,a,e,r){return t.numberOfProtectedTags()>0?(r.displayProtectedTagForDiscussionList=o().forum.attribute("flarum-tag-passwords.displayProtectedTagForDiscussionList"),r.displayDiscussionAvator=o().forum.attribute("flarum-tag-passwords.displayDiscussionAvator"),r.displayDiscussionLabel=o().forum.attribute("flarum-tag-passwords.displayDiscussionLabel"),m("li",{key:0,"data-id":0,role:"article","aria-setsize":"-1","aria-posinset":s*a+e},m(ct,{discussion:t,params:r}))):m("li",{key:t.id(),"data-id":t.id(),role:"article","aria-setsize":"-1","aria-posinset":s*a+e},m(J(),{discussion:t,params:r}))}(t,s,i,e,a)}))}))),m("div",{className:"DiscussionList-loadMore"},t))}o().initializers.add("datlechin/flarum-tag-passwords",(function(){i().prototype.isPasswordProtected=c().attribute("isPasswordProtected"),i().prototype.isGroupProtected=c().attribute("isGroupProtected"),i().prototype.isUnlocked=c().attribute("isUnlocked"),i().prototype.password=c().attribute("password"),i().prototype.isLockedIconDisplayed=c().attribute("isLockedIconDisplayed"),i().prototype.isProtectedTagDisplayedForSidebar=c().attribute("isProtectedTagDisplayedForSidebar"),i().prototype.isProtectedTagDisplayedForTagsPage=c().attribute("isProtectedTagDisplayedForTagsPage"),u().prototype.protectedPasswordTags=c().attribute("protectedPasswordTags"),u().prototype.protectedGroupPermissionTags=c().attribute("protectedGroupPermissionTags"),u().prototype.numberOfProtectedTags=c().attribute("numberOfProtectedTags"),(0,e.extend)(p().prototype,"view",(function(t){var s=this.currentTag();s&&!s.isUnlocked()&&(s.isGroupProtected()?dt(t,["container","sideNavContainer","IndexPage-results"],0,[L.component({currentTag:s})]):s.isPasswordProtected()&&dt(t,["container","sideNavContainer","IndexPage-results"],0,[k.component({currentTag:s})]))})),(0,e.override)(R().prototype,"view",pt),(0,e.extend)(p().prototype,"sidebarItems",(function(t){var s=this.currentTag();if(s&&(s.isPasswordProtected()||s.isGroupProtected())&&!s.isUnlocked()){var a=t.get("newDiscussion");a.children=o().translator.trans("core.forum.index.cannot_start_discussion_button"),a.attrs.disabled=!0}})),(0,e.extend)(g().prototype,"view",(function(t){var s=this.attrs.model;mt(t,s,s.isPasswordProtected(),v()("fas fa-lock")),mt(t,s,s.isGroupProtected(),v()("fas fa-user-lock"))})),(0,e.override)(I().prototype,"tagTileView",(function(t){for(var s=arguments.length,a=new Array(s>1?s-1:0),e=1;e<s;e++)a[e-1]=arguments[e];if(a.length>0&&a[0]instanceof i()){var r=a[0];if(r.isUnlocked()||!r.isGroupProtected()&&!r.isPasswordProtected()||r.isProtectedTagDisplayedForTagsPage()){var n=F()(r.children()||[]);return m("li",{className:A()("TagTile",{colored:r.color()},z()(r.color())),style:{"--tag-bg":r.color()}},m(q(),{className:"TagTile-info",href:o().route.tag(r)},r.icon()&&O()(r,{},{useColor:!1}),function(t){return t.isGroupProtected()&&!t.isUnlocked()?m("div",{class:"TagsPageGroupProtection"}):t.isPasswordProtected()&&!t.isUnlocked()?m("div",{class:"TagsPagePasswordProtection"}):m("[",null)}(r),m("h3",{className:"TagTile-name"},r.name()),m("p",{className:"TagTile-description"},r.description()),!!n&&m("div",{className:"TagTile-children"},n.map((function(t){var s=null;if(t.isPasswordProtected())if(t.isUnlocked())t.isLockedIconDisplayed()&&(s=v()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}));else{if(!t.isProtectedTagDisplayedForTagsPage())return m("[",null);s=v()("fas fa-lock",{style:{fontSize:"13px",float:"none"}})}if(t.isGroupProtected())if(t.isUnlocked())t.isLockedIconDisplayed()&&(s=v()("fas fa-unlock",{style:{fontSize:"13px",float:"none"}}));else{if(!t.isProtectedTagDisplayedForTagsPage())return m("[",null);s=v()("fas fa-user-lock",{style:{fontSize:"13px",float:"none"}})}return[m(q(),{href:o().route.tag(t)},t.name()," ",s)," "]})))),m("span",{className:"TagTile-lastPostedDiscussion"},function(t){if(t.isGroupProtected()&&!t.isUnlocked())return m("div",null,v()("fas fa-user-lock")," ",o().translator.trans("datlechin-tag-passwords.forum.tags_page.group_protected"));if(t.isPasswordProtected()&&!t.isUnlocked())return m("div",null,v()("fas fa-lock")," ",o().translator.trans("datlechin-tag-passwords.forum.tags_page.password_protected"));var s=t.lastPostedDiscussion();if(s){if(s.numberOfProtectedTags()>0){var a=s.protectedPasswordTags(),e=a.length>0,r=s.protectedGroupPermissionTags(),i=r.length>0,n=a.concat(r);return m(q(),{className:"TagTile-lastPostedDiscussion",href:"/t/"+n[0].slug},m("span",{className:"TagTile-lastPostedDiscussion-title"},i?v()("fas fa-user-lock"):m("[",null),e?v()("fas fa-lock"):m("[",null),i&&e?o().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.multiple"):i?o().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.group_protected"):o().translator.trans("datlechin-tag-passwords.forum.tags_page.discussion.password_protected")),B()(s.lastPostedAt()))}return m(q(),{className:"TagTile-lastPostedDiscussion",href:o().route.discussion(s,s.lastPostNumber())},m("span",{className:"TagTile-lastPostedDiscussion-title"},s.title()),B()(s.lastPostedAt()))}return m("span",{className:"TagTile-lastPostedDiscussion"})}(r)))}return""}return t.apply(void 0,a)})),(0,e.override)(I().prototype,"contentItems",(function(){var t=new(ut());if(this.loading)t.add("loading",m(K(),null));else{var s=this.tags.filter((function(t){return null!==t.position()})),a=this.tags.filter((function(t){return null===t.position()}));t.add("tagTiles",this.tagTileListView(s),100),a.length&&t.add("cloud",function(t){return m("div",{className:"TagCloud"},t.map((function(t){return[et(t,{link:!0},t.isProtectedTagDisplayedForTagsPage())," "]})))}(a),10)}return t}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map