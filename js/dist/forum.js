(()=>{var t={n:o=>{var r=o&&o.__esModule?()=>o.default:()=>o;return t.d(r,{a:r}),r},d:(o,r)=>{for(var a in r)t.o(r,a)&&!t.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:r[a]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o);const r=flarum.core.compat["forum/app"];var a=t.n(r);const e=flarum.core.compat["common/extend"],s=flarum.core.compat["tags/models/Tag"];var i=t.n(s);const n=flarum.core.compat["common/Model"];var c=t.n(n);const d=flarum.core.compat["forum/components/IndexPage"];var l=t.n(d);const u=flarum.core.compat["tags/components/TagLinkButton"];var p=t.n(u);const g=flarum.core.compat["common/helpers/icon"];var h=t.n(g);function f(t,o){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},f(t,o)}function v(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,f(t,o)}const y=flarum.core.compat["common/Component"];var b=t.n(y);const P=flarum.core.compat["common/utils/Stream"];var T=t.n(P);const w=flarum.core.compat["common/components/Button"];var _=t.n(w),k=function(t){function o(){return t.apply(this,arguments)||this}v(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o),this.password=T()(""),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},r.view=function(){return m("div",{className:"TagPasswordRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,a().translator.trans("datlechin-tag-passwords.forum.tag_password_required.title")),m("input",{className:"FormControl"+(this.invalid?" invalid":""),bidi:this.password,disabled:this.loading})),m(_(),{type:"submit",className:"Button Button--primary",loading:this.loading},a().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},r.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0,this.invalid=!1,a().request({url:a().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id(),password:this.password}}}).then((function(t){o.tag.pushAttributes({isUnlocked:!0}),o.loading=!1,o.invalid=!1,m.redraw()})).catch((function(t){o.invalid=!0,o.loading=!1}))},o}(b()),D=function(t){function o(){return t.apply(this,arguments)||this}v(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o),this.loading=!1,this.invalid=!1,this.tag=this.attrs.currentTag},r.view=function(){return m("div",{className:"TagGroupRequired"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("h3",null,a().translator.trans("datlechin-tag-passwords.forum.tag_group_required.title"))),m(_(),{type:"submit",className:"Button Button--primary",loading:this.loading},a().translator.trans("datlechin-tag-passwords.forum.tag_password_required.button_submit"))))},r.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0,this.invalid=!1,a().request({url:a().forum.attribute("apiUrl")+"/datlechin/tag-passwords/auth",method:"POST",body:{data:{id:this.tag.id()}}}).then((function(t){o.tag.pushAttributes({isUnlocked:!0}),o.loading=!1,o.invalid=!1,m.redraw()})).catch((function(t){o.invalid=!0,o.loading=!1}))},o}(b());const N=flarum.core.compat["tags/components/TagsPage"];var O=t.n(N);const S=flarum.core.compat["tags/common/helpers/tagIcon"];var U=t.n(S);const F=flarum.core.compat["tags/common/utils/sortTags"];var G=t.n(F);const q=flarum.core.compat["common/utils/classList"];var x=t.n(q);const j=flarum.core.compat["common/helpers/textContrastClass"];var I=t.n(j);const L=flarum.core.compat["common/components/Link"];var B=t.n(L);flarum.core.compat["common/helpers/humanTime"],a().initializers.add("datlechin/flarum-tag-passwords",(function(){i().prototype.isPasswordProtected=c().attribute("isPasswordProtected"),i().prototype.isGroupProtected=c().attribute("isGroupProtected"),i().prototype.isUnlocked=c().attribute("isUnlocked"),i().prototype.password=c().attribute("password"),i().prototype.isLockedIconDisplayed=c().attribute("isLockedIconDisplayed"),i().prototype.isProtectedTagDisplayedForSidebar=c().attribute("isProtectedTagDisplayedForSidebar"),i().prototype.isProtectedTagDisplayedForTagsPage=c().attribute("isProtectedTagDisplayedForTagsPage"),(0,e.extend)(l().prototype,"view",(function(t){var o=this.currentTag();o&&!o.isUnlocked()&&(o.isGroupProtected()?t.children[1].children[0].children[1].children=[D.component({currentTag:o})]:o.isPasswordProtected()&&(t.children[1].children[0].children[1].children=[k.component({currentTag:o})]))})),(0,e.extend)(l().prototype,"sidebarItems",(function(t){var o=this.currentTag();if(o&&(o.isPasswordProtected()||o.isGroupProtected())&&!o.isUnlocked()){var r=t.get("newDiscussion");r.children=a().translator.trans("core.forum.index.cannot_start_discussion_button"),r.attrs.disabled=!0}})),(0,e.extend)(p().prototype,"view",(function(t){var o=this.attrs.model;o.isPasswordProtected()&&(o.isUnlocked()?1==o.isLockedIconDisplayed()&&t.children.push(h()("fas fa-unlock")):1==o.isProtectedTagDisplayedForSidebar()?t.children.push(h()("fas fa-lock")):t.attrs.className+=" hiddenTag"),o.isGroupProtected()&&(o.isUnlocked()?1==o.isLockedIconDisplayed()&&t.children.push(h()("fas fa-unlock")):1==o.isProtectedTagDisplayedForSidebar()?t.children.push(h()("fas fa-user-lock")):t.attrs.className+=" hiddenTag")})),(0,e.override)(O().prototype,"tagTileView",(function(t){for(var o=arguments.length,r=new Array(o>1?o-1:0),e=1;e<o;e++)r[e-1]=arguments[e];if(r.length>0&&r[0]instanceof i()){var s=r[0];if(s.isGroupProtected()||s.isPasswordProtected()){if(s.isUnlocked())return t.apply(void 0,r);if(1==s.isProtectedTagDisplayedForTagsPage()){var n=G()(s.children()||[]);return m("li",{className:x()("TagTile",{colored:s.color()},I()(s.color())),style:{"--tag-bg":s.color()}},m(B(),{className:"TagTile-info",href:a().route.tag(s)},s.icon()&&U()(s,{},{useColor:!1}),s.isGroupProtected()?m("div",{class:"TagsPageGroupProtection"}):m("div",{class:"TagsPagePasswordProtection"}),m("h3",{className:"TagTile-name"},s.name()),m("p",{className:"TagTile-description"},s.description()),!!n&&m("div",{className:"TagTile-children"},n.map((function(t){return[m(B(),{href:a().route.tag(t)},t.name())," "]})))),m("span",{className:"TagTile-lastPostedDiscussion"},s.isGroupProtected()?m("div",null,h()("fas fa-user-lock")," ",a().translator.trans("datlechin-tag-passwords.forum.tags_page.group_protected")):m("div",null,h()("fas fa-lock")," ",a().translator.trans("datlechin-tag-passwords.forum.tags_page.password_protected"))))}return""}return t.apply(void 0,r)}return t.apply(void 0,r)}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map