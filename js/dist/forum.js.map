{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@datlechin/flarum-tag-passwords/./src/forum/components/TagPasswordRequired.js","webpack://@datlechin/flarum-tag-passwords/./src/forum/index.js","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['common/Component']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['common/Model']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['common/components/Button']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['common/extend']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['forum/app']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['tags/components/TagLinkButton']\"","webpack://@datlechin/flarum-tag-passwords/external root \"flarum.core.compat['tags/models/Tag']\"","webpack://@datlechin/flarum-tag-passwords/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@datlechin/flarum-tag-passwords/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@datlechin/flarum-tag-passwords/webpack/bootstrap","webpack://@datlechin/flarum-tag-passwords/webpack/runtime/compat get default export","webpack://@datlechin/flarum-tag-passwords/webpack/runtime/define property getters","webpack://@datlechin/flarum-tag-passwords/webpack/runtime/hasOwnProperty shorthand","webpack://@datlechin/flarum-tag-passwords/webpack/runtime/make namespace object","webpack://@datlechin/flarum-tag-passwords/./forum.js"],"sourcesContent":["import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Stream from 'flarum/common/utils/Stream';\nimport Button from 'flarum/common/components/Button';\n\nexport default class TagPasswordRequired extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.password = Stream('');\n    this.loading = false;\n    this.invalid = false;\n\n    this.tag = this.attrs.currentTag;\n  }\n\n  view() {\n    return (\n      <div className=\"TagPasswordRequired\">\n        <form onsubmit={this.onsubmit.bind(this)}>\n          <div className=\"Form-group\">\n            <h3>{app.translator.trans('datlechin-tag-passwords.forum.tag_password_required.title')}</h3>\n            <input className={'FormControl' + (this.invalid ? ' invalid' : '')} bidi={this.password} disabled={this.loading} />\n          </div>\n          <Button type=\"submit\" className=\"Button Button--primary\" loading={this.loading}>\n            {app.translator.trans('datlechin-tag-passwords.forum.tag_password_required.button_submit')}\n          </Button>\n        </form>\n      </div>\n    );\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    this.loading = true;\n    this.invalid = false;\n\n    app\n      .request({\n        url: app.forum.attribute('apiUrl') + '/datlechin/tag-passwords/auth',\n        method: 'POST',\n        body: {\n          data: {\n            id: this.tag.id(),\n            password: this.password,\n          },\n        },\n      })\n      .then((result) => {\n        this.tag.pushAttributes({ isUnlocked: true });\n        this.loading = false;\n        this.invalid = false;\n        m.redraw();\n      })\n      .catch((error) => {\n        this.invalid = true;\n        this.loading = false;\n      });\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport Tag from 'flarum/tags/models/Tag';\nimport Model from 'flarum/common/Model';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport TagLinkButton from 'flarum/tags/components/TagLinkButton';\nimport icon from 'flarum/common/helpers/icon';\nimport TagPasswordRequired from './components/TagPasswordRequired';\n\napp.initializers.add('datlechin/flarum-tag-passwords', () => {\n  Tag.prototype.isPasswordProtected = Model.attribute('isPasswordProtected');\n  Tag.prototype.isUnlocked = Model.attribute('isUnlocked');\n  Tag.prototype.password = Model.attribute('password');\n\n  extend(IndexPage.prototype, 'view', function (vdom) {\n    const tag = this.currentTag();\n\n    if (tag && tag.isPasswordProtected() && !tag.isUnlocked()) {\n      vdom.children[1].children[0].children[1].children = [TagPasswordRequired.component({ currentTag: tag })];\n    }\n  });\n\n  extend(IndexPage.prototype, 'sidebarItems', function (items) {\n    const tag = this.currentTag();\n\n    if (tag && tag.isPasswordProtected() && !tag.isUnlocked()) {\n      const item = items.get('newDiscussion');\n\n      item.children = app.translator.trans('core.forum.index.cannot_start_discussion_button');\n      item.attrs.disabled = true;\n    }\n  });\n\n  extend(TagLinkButton.prototype, 'view', function (vdom) {\n    const tag = this.attrs.model;\n\n    if (tag.isPasswordProtected() && !tag.isUnlocked()) {\n      vdom.children.push(icon('fas fa-lock'));\n    }\n  });\n});\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/helpers/icon'];","module.exports = flarum.core.compat['common/utils/Stream'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/IndexPage'];","module.exports = flarum.core.compat['tags/components/TagLinkButton'];","module.exports = flarum.core.compat['tags/models/Tag'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './src/forum';\n"],"names":["app","Component","Stream","Button","TagPasswordRequired","oninit","vnode","password","loading","invalid","tag","attrs","currentTag","view","onsubmit","bind","translator","trans","e","preventDefault","request","url","forum","attribute","method","body","data","id","then","result","pushAttributes","isUnlocked","m","redraw","error","extend","Tag","Model","IndexPage","TagLinkButton","icon","initializers","add","prototype","isPasswordProtected","vdom","children","component","items","item","get","disabled","model","push","setPrototypeOf","_inheritsLoose","subClass","superClass","Object","create","constructor","_setPrototypeOf","o","p","__proto__"],"sourceRoot":""}